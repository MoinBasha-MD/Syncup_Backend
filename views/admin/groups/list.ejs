<!-- Page Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
    <div>
        <h3 style="font-size: 20px; font-weight: 700; color: #0f172a; margin: 0 0 4px 0;">Groups Management</h3>
        <p style="color: #64748b; margin: 0;">Manage all groups â€¢ <%= totalGroups %> total groups</p>
    </div>
    <a href="/admin/groups/create" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Create Group
    </a>
</div>

<!-- Search -->
<div class="table-card" style="margin-bottom: 24px;">
    <form method="GET">
        <div class="row g-3">
            <div class="col-md-8">
                <input type="text" name="search" class="form-control" placeholder="Search groups..." value="<%= search %>" style="border-radius: 10px; border: 1px solid #E2E8F0; padding: 10px 16px;">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Search</button>
            </div>
            <div class="col-md-2">
                <a href="/admin/groups" class="btn w-100" style="background: #F8FAFC; color: #64748b; border: 1px solid #E2E8F0;">Reset</a>
            </div>
        </div>
    </form>
</div>

<!-- Groups Table -->
<div class="table-card">
    <div class="table-header">
        <h5>All Groups (<%= totalGroups %>)</h5>
    </div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Group Name</th>
                    <th>Description</th>
                    <th>Members</th>
                    <th>Created By</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (groups && groups.length > 0) { %>
                    <% groups.forEach(group => { %>
                        <tr>
                            <td>
                                <div style="font-weight: 600; color: #0f172a;"><%= group.name %></div>
                            </td>
                            <td>
                                <div style="color: #64748b; font-size: 14px;">
                                    <%= group.description ? group.description.substring(0, 50) + '...' : 'N/A' %>
                                </div>
                            </td>
                            <td>
                                <span class="badge badge-info"><%= group.membersCount || 0 %> members</span>
                            </td>
                            <td>
                                <div style="color: #64748b; font-size: 14px;">
                                    <%= group.createdBy ? group.createdBy.name : 'Unknown' %>
                                </div>
                            </td>
                            <td>
                                <div style="color: #64748b; font-size: 14px;">
                                    <%= new Date(group.createdAt).toLocaleDateString() %>
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 8px;">
                                    <a href="/admin/groups/<%= group._id %>" class="btn btn-sm" style="background: #DBEAFE; color: #1E40AF; padding: 6px 12px;">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="/admin/groups/<%= group._id %>/edit" class="btn btn-sm" style="background: #E0E7FF; color: #4338CA; padding: 6px 12px;">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button onclick="deleteGroup('<%= group._id %>')" class="btn btn-sm" style="background: #FEE2E2; color: #DC2626; padding: 6px 12px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;">
                            No groups found
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<script>
async function deleteGroup(id) {
    if (!confirm('Delete this group?')) return;
    try {
        const res = await fetch(`/admin/groups/${id}`, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) { alert(data.message); location.reload(); }
    } catch (error) { alert('Error deleting group'); }
}
</script>
